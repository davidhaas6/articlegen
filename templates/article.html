{% extends "base.html" %}

{% block title %}{{title}} - Rat News Network{% endblock %}

{% block extra_head %}
<meta property="og:title" content="{{ title|safe }}">
<meta property="og:description" content="{{ overview|safe }}">
<meta property="og:image" content="{{ 'https://ratnewsnetwork.com/static/img/' + img_path }}">
<meta property="og:type" content="article">
{% endblock %}

{% block content %}
<div class="container content">
    <h1>{{ title }}</h1>
    <div class="overview">{{ overview|safe }}</div>
    <span class="read-time">{{reading_time}} minute read â€¢ 
        <a href="#comments-section" id="scroll-to-comments" class="comments-link">Comments</a><span>
    </span>
    {% if img_path != None %}
    <img src="static/img/{{img_path}}" alt="article image">
    {% endif %}
    <br>
    <div class="article-container">
        <span class="article-body">
            {{ body|safe }}
            <br>
            <br>
            <br>
            <i>Looking for more in-depth news and exclusive content? Follow <a href="https://tiktok.com/@ratnewsnetwork">RAT TV</a> for real-time updates, behind-the-scenes insights and the latest breaking news.</i>
        </span>
    </div>
    {% if comments|length > 0 %}
    <div id="comments-section" class="article-comments">
        <h1>Comments</h1>
        {% for comment in comments %}
        <div class="comment">
            <div class="comment-author">{{comment.username}}</div>
            <div class="comment-body">{{comment.text}}</div>
            <div class="votes">
                <button class="vote-up-count">+{{comment.upvotes}}</button>
                <button class="vote-down-count">-{{comment.downvotes}}</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
</div>

<script>
     function incrementButton(button, prefix) {
        if (button.classList.contains('clicked')) {
                button.innerHTML = prefix + (parseInt(button.innerHTML.replace(prefix, "")) - 1);
                button.classList.remove('clicked');
                return;
        }
        button.classList.add('clicked');
        button.innerHTML = prefix + (parseInt(button.innerHTML.replace(prefix, "")) + 1);
    }
    document.querySelectorAll('.vote-up-count').forEach(button => {
        button.addEventListener('click', () => {
            incrementButton(button, '+');
        });
    });
    document.querySelectorAll('.vote-down-count').forEach(button => {
        button.addEventListener('click', () => {
            incrementButton(button, '-');
        });
    });

    // smooth scrolling
    document.getElementById('scroll-to-comments').addEventListener('click', function(e) {
        e.preventDefault(); // Prevent the default link behavior
        document.getElementById('comments-section').scrollIntoView({
            behavior: 'smooth'
        });
    });
</script>

{% endblock %}